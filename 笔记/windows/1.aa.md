# 获取屏幕




```c
#include <iostream>
#include <opencv2/opencv.hpp>
#include <Windows.h> // Windows特定的头文件，用于获取屏幕截图

using namespace std;
using namespace cv;

int main()
{
	// 获取屏幕分辨率
	int screen_width = GetSystemMetrics(SM_CXSCREEN);
	int screen_height = GetSystemMetrics(SM_CYSCREEN);

	// 创建OpenCV窗口
	namedWindow("Screen Capture", WINDOW_NORMAL);
	resizeWindow("Screen Capture", screen_width, screen_height);

	// 不断循环，捕获并显示屏幕截图
	while (true) {
		// 获取屏幕截图
		HDC hDC = GetDC(NULL);
		HDC hMemDC = CreateCompatibleDC(hDC);
		HBITMAP hBitmap = CreateCompatibleBitmap(hDC, screen_width, screen_height);
		HGDIOBJ hOld = SelectObject(hMemDC, hBitmap);
		BitBlt(hMemDC, 0, 0, screen_width, screen_height, hDC, 0, 0, SRCCOPY);

		// 将截图转换为OpenCV的Mat格式
		BITMAPINFO bmp_info;
		bmp_info.bmiHeader.biSize = sizeof(bmp_info.bmiHeader);
		bmp_info.bmiHeader.biWidth = screen_width;
		bmp_info.bmiHeader.biHeight = -screen_height;
		bmp_info.bmiHeader.biPlanes = 1;
		bmp_info.bmiHeader.biBitCount = 32;
		bmp_info.bmiHeader.biCompression = BI_RGB;
		bmp_info.bmiHeader.biSizeImage = 0;
		bmp_info.bmiHeader.biXPelsPerMeter = 0;
		bmp_info.bmiHeader.biYPelsPerMeter = 0;
		bmp_info.bmiHeader.biClrUsed = 0;
		bmp_info.bmiHeader.biClrImportant = 0;

		Mat screen_img(screen_height, screen_width, CV_8UC4);
		GetDIBits(hMemDC, hBitmap, 0, screen_height, screen_img.data, &bmp_info, DIB_RGB_COLORS);

		// 显示截图
		imshow("Screen Capture", screen_img);

		// 释放内存
		SelectObject(hMemDC, hOld);
		DeleteObject(hBitmap);
		DeleteDC(hMemDC);
		ReleaseDC(NULL, hDC);

		// 检测按键，如果是'q'则退出程序
		if (waitKey(1) == 'q')
			break;
	}

	// 关闭窗口并释放内存
	destroyWindow("Screen Capture");
	return 0;
}


```